# Makefile placeholder
#
# compiler/Makefile
# Build script for the Q-Verifier C/C++ Compiler
#

# --- Compiler and Flags ---
CC = gcc
CFLAGS = -Wall -g  # -Wall (all warnings) -g (debug symbols)
LFLAGS = -lfl      # Link the Flex library (-lfl)

# --- Executable Name ---
TARGET = q_compiler

# --- Source Files ---
# .c files we wrote ourselves
C_SOURCES = main.c ast_helpers.c
# .c files generated by Flex/Bison
GEN_SOURCES = lex.yy.c y.tab.c

# --- Object Files ---
# Create a .o for each .c file
OBJECTS = $(C_SOURCES:.c=.o) $(GEN_SOURCES:.c=.o)

# --- Header Files ---
# .h files we wrote ourselves
H_SOURCES = ast.h ast_helpers.h
# .h file generated by Bison
GEN_H_SOURCES = y.tab.h

# --- Default Target: "all" ---
# This is what runs when you just type "make"
# It depends on our final executable
all: $(TARGET)

# --- Rule to build the final executable ---
# Depends on all our compiled .o files
$(TARGET): $(OBJECTS)
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJECTS) $(LFLAGS)

# --- Rule to compile .c files into .o files ---
# This is a generic rule. e.g., "make main.o"
%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# --- Rule to generate C code from Bison ---
# "y.tab.c" and "y.tab.h" depend on "parser.y"
# -d flag creates the y.tab.h header file
y.tab.c y.tab.h: parser.y ast.h
	bison -d -v parser.y

# --- Rule to generate C code from Flex ---
# "lex.yy.c" depends on "lexer.l" and the header from Bison
lex.yy.c: lexer.l y.tab.h
	flex lexer.l

# --- Clean Target ---
# Runs when you type "make clean"
# Removes all generated files
clean:
	rm -f $(TARGET) $(OBJECTS) lex.yy.c y.tab.c y.tab.h y.output